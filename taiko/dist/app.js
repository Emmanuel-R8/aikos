var f=5603,n=512,_=512;var P=65536,g=10;var M=0;var e=2883584,$$=655360,Z$=786432;class i{static lispPtrToByte($){return $*2}static byteToLispPtr($){return Math.floor($/2)}static getVirtualPage($){return Math.floor($/_)}static getPageOffset($){return $%_}static getVirtualAddressBase($){return $*_}}class s{static getFilePageForVirtualPage($,q){for(let Q=0;Q<$.length;Q++)if(($[Q]&65535)===q)return Q;return null}static getPageOK($,q){if(q<$.length)return $[q]>>16&65535;return 0}static getFileOffset($){return $*512}static getVirtualPage($){return $&65535}static getPageStatus($){return $>>16&65535}}class T{static needsByteSwap($,q){let Q=Math.floor(q/4)+1;return $<Q}static swapU32($){return($&255)<<24|($&65280)<<8|($&16711680)>>8|($&4278190080)>>>24}static swapU16($){return($&255)<<8|($&65280)>>8}static applyXorAddressing($){return $^3}static readWordXor($,q){let Q=q^3,J=q+1^3,W=Q<$.length?$[Q]:0,L=J<$.length?$[J]:0;return W|L<<8}static readWordLittleEndian($,q){let Q=q<$.length?$[q]:0,J=q+1<$.length?$[q+1]:0;return Q|J<<8}static readByteXor($,q){if(q<$.length){let Q=q^3;if(Q<$.length)return $[Q]}return null}}class q${static readByte($,q){if(q>=0&&q<$.length)return $[q];return null}static readByteXor($,q){return T.readByteXor($,q)}static readInstructionBytes($,q,Q){let J=Math.min(q+Q,$.length);if(q<J&&q>=0)return $.slice(q,J);return new Uint8Array(0)}static readDLword($,q){if(q>=0&&q+1<$.length)return $[q]|$[q+1]<<8;return 0}static readDLwordXor($,q){return T.readWordXor($,q)}static readLispPTR($,q){let Q=this.readDLword($,q);return this.readDLword($,q+2)<<16|Q}static writeDLword($,q,Q){if(q>=0&&q+1<$.length)$[q]=Q&255,$[q+1]=Q>>8&255}static writeLispPTR($,q,Q){this.writeDLword($,q,Q&65535),this.writeDLword($,q+2,Q>>16&65535)}static readJumpOffset($,q){return T.readWordXor($,q+1)<<16>>16}static readJumpOffsetRaw($,q){return T.readWordLittleEndian($,q+1)<<16>>16}}class j{static Address=i;static FPtoVP=s;static Endianness=T;static Access=q$}class t{stackBase;stackPtr;stackEnd;currentFrame=null;virtualMemory=null;fptovpTable=null;atomSpaceOffset=0;defSpaceOffset=0;valSpaceOffset=0;pc=0;returnPc=null;funcObj=null;pvar=null;ivar=null;topOfStack=0;cstkptrl=null;stopRequested=!1;running=!1;totalInstructionCount=0;stepCapActive=!1;maxSteps=null;displayRegion=null;displayWidth=0;displayHeight=0;displayRegionOffset=0;constructor($=65536){this.stackBase=P*2,this.stackPtr=this.stackBase,this.stackEnd=this.stackBase-$}initializeMemory($,q,Q,J,W){this.virtualMemory=$,this.fptovpTable=q,this.atomSpaceOffset=Q,this.defSpaceOffset=J,this.valSpaceOffset=W}initializeDisplay($,q,Q){if(this.displayWidth=q,this.displayHeight=Q,this.displayRegionOffset=j.Address.lispPtrToByte($),this.virtualMemory&&this.displayRegionOffset<this.virtualMemory.length){let J=Math.floor(q*Q/16),W=this.displayRegionOffset+J*2;if(W<=this.virtualMemory.length){let L=this.virtualMemory.buffer.slice(this.virtualMemory.byteOffset+this.displayRegionOffset,this.virtualMemory.byteOffset+W);this.displayRegion=new Uint16Array(L)}}}getDisplayRegion(){return this.displayRegion}getStackPtrOffset(){if(this.virtualMemory===null)return 0;let $=this.stackPtr,Q=this.stackBase-$;return Math.floor(Q/2)}getFramePtrOffset(){if(this.currentFrame===null)return 0;return this.getStackPtrOffset()}readTopOfStackFromMemory(){if(this.virtualMemory===null||this.cstkptrl===null)return 0;let $=this.cstkptrl-4;if($>=0&&$+4<=this.virtualMemory.length){let q=this.virtualMemory[$]|this.virtualMemory[$+1]<<8;return(this.virtualMemory[$+2]|this.virtualMemory[$+3]<<8)<<16|q}return 0}initCSTKPTRLFromCurrentStackPTR(){this.cstkptrl=this.stackPtr}syncTopOfStack(){this.topOfStack=this.readTopOfStackFromMemory()}reset(){this.pc=0,this.returnPc=null,this.stopRequested=!1,this.running=!1,this.totalInstructionCount=0,this.topOfStack=0,this.cstkptrl=null,this.currentFrame=null,this.funcObj=null,this.pvar=null,this.ivar=null,this.stackPtr=this.stackBase}}var D;((Z)=>{Z[Z.NIL=104]="NIL";Z[Z.T=105]="T";Z[Z.CONST_0=106]="CONST_0";Z[Z.CONST_1=107]="CONST_1";Z[Z.ACONST=103]="ACONST";Z[Z.SIC=108]="SIC";Z[Z.SNIC=109]="SNIC";Z[Z.SICX=110]="SICX";Z[Z.GCONST=111]="GCONST";Z[Z.FN0=8]="FN0";Z[Z.FN1=9]="FN1";Z[Z.FN2=10]="FN2";Z[Z.FN3=11]="FN3";Z[Z.FN4=12]="FN4";Z[Z.FNX=13]="FNX";Z[Z.APPLYFN=14]="APPLYFN";Z[Z.CHECKAPPLY=15]="CHECKAPPLY";Z[Z.RETURN=16]="RETURN";Z[Z.BIND=17]="BIND";Z[Z.UNBIND=18]="UNBIND";Z[Z.DUNBIND=19]="DUNBIND";Z[Z.RPLPTR_N=20]="RPLPTR_N";Z[Z.GCREF=21]="GCREF";Z[Z.ASSOC=22]="ASSOC";Z[Z.GVAR_=23]="GVAR_";Z[Z.CAR=1]="CAR";Z[Z.CDR=2]="CDR";Z[Z.NTYPX=4]="NTYPX";Z[Z.CONS=26]="CONS";Z[Z.CMLASSOC=27]="CMLASSOC";Z[Z.FMEMB=28]="FMEMB";Z[Z.CMLMEMBER=29]="CMLMEMBER";Z[Z.FINDKEY=30]="FINDKEY";Z[Z.CREATECELL=31]="CREATECELL";Z[Z.WRTPTRTAG=54]="WRTPTRTAG";Z[Z.BIN=32]="BIN";Z[Z.BOUT=33]="BOUT";Z[Z.RPLCONS=38]="RPLCONS";Z[Z.LISTGET=39]="LISTGET";Z[Z.ELT=40]="ELT";Z[Z.NTHCHC=41]="NTHCHC";Z[Z.SETA=42]="SETA";Z[Z.RPLCHARCODE=43]="RPLCHARCODE";Z[Z.EVAL=44]="EVAL";Z[Z.ENVCALL=45]="ENVCALL";Z[Z.TYPECHECK=46]="TYPECHECK";Z[Z.BUSBLT=48]="BUSBLT";Z[Z.MISC8=49]="MISC8";Z[Z.UBFLOAT3=50]="UBFLOAT3";Z[Z.RPLACA=24]="RPLACA";Z[Z.RPLACD=25]="RPLACD";Z[Z.TYPEP=5]="TYPEP";Z[Z.DTEST=6]="DTEST";Z[Z.UNWIND=7]="UNWIND";Z[Z.MISCN=36]="MISCN";Z[Z.POPDISP=34]="POPDISP";Z[Z.RESTLIST=35]="RESTLIST";Z[Z.GVAR=96]="GVAR";Z[Z.ARG0=97]="ARG0";Z[Z.PVARX_=95]="PVARX_";Z[Z.IVARX_=98]="IVARX_";Z[Z.FVARX_=99]="FVARX_";Z[Z.POP=191]="POP";Z[Z.POP_N=192]="POP_N";Z[Z.ATOMCELL_N=193]="ATOMCELL_N";Z[Z.GETBASEBYTE=194]="GETBASEBYTE";Z[Z.INSTANCEP=195]="INSTANCEP";Z[Z.BLT=196]="BLT";Z[Z.MISC10=197]="MISC10";Z[Z.PUTBASEBYTE=199]="PUTBASEBYTE";Z[Z.GETBASE_N=200]="GETBASE_N";Z[Z.ITIMES2=201]="ITIMES2";Z[Z.GETBITS_N_FD=202]="GETBITS_N_FD";Z[Z.PUTBASE_N=205]="PUTBASE_N";Z[Z.PUTBASEPTR_N=206]="PUTBASEPTR_N";Z[Z.PUTBITS_N_FD=207]="PUTBITS_N_FD";Z[Z.ADDBASE=208]="ADDBASE";Z[Z.VAG2=209]="VAG2";Z[Z.HILOC=210]="HILOC";Z[Z.LOLOC=211]="LOLOC";Z[Z.PLUS2=212]="PLUS2";Z[Z.DIFFERENCE=213]="DIFFERENCE";Z[Z.TIMES2=214]="TIMES2";Z[Z.QUOTIENT=215]="QUOTIENT";Z[Z.CMLEQUAL=204]="CMLEQUAL";Z[Z.IPLUS2=216]="IPLUS2";Z[Z.IDIFFERENCE=217]="IDIFFERENCE";Z[Z.LLSH8=218]="LLSH8";Z[Z.IQUOTIENT=219]="IQUOTIENT";Z[Z.IREMAINDER=220]="IREMAINDER";Z[Z.IPLUS_N=221]="IPLUS_N";Z[Z.IDIFFERENCE_N=222]="IDIFFERENCE_N";Z[Z.BASE_LESSTHAN=223]="BASE_LESSTHAN";Z[Z.LLSH1=224]="LLSH1";Z[Z.LRSH1=226]="LRSH1";Z[Z.LRSH8=227]="LRSH8";Z[Z.LOGOR2=228]="LOGOR2";Z[Z.LOGAND2=229]="LOGAND2";Z[Z.LOGXOR2=230]="LOGXOR2";Z[Z.LSH=231]="LSH";Z[Z.GETBASEPTR_N=236]="GETBASEPTR_N";Z[Z.AREF2=238]="AREF2";Z[Z.UBFLOAT1=237]="UBFLOAT1";Z[Z.UBFLOAT2=225]="UBFLOAT2";Z[Z.FPLUS2=232]="FPLUS2";Z[Z.FDIFFERENCE=233]="FDIFFERENCE";Z[Z.FTIMES2=234]="FTIMES2";Z[Z.FQUOTIENT=235]="FQUOTIENT";Z[Z.ASET2=239]="ASET2";Z[Z.TYPEMASK_N=51]="TYPEMASK_N";Z[Z.MISC7=56]="MISC7";Z[Z.EQL=58]="EQL";Z[Z.DRAWLINE=59]="DRAWLINE";Z[Z.STORE_N=60]="STORE_N";Z[Z.RAID=62]="RAID";Z[Z.COPY_N=61]="COPY_N";Z[Z.RECLAIMCELL=122]="RECLAIMCELL";Z[Z.GCSCAN1=123]="GCSCAN1";Z[Z.GCSCAN2=124]="GCSCAN2";Z[Z.CONTEXTSWITCH=126]="CONTEXTSWITCH";Z[Z.RETCALL=127]="RETCALL";Z[Z.FGREATERP=242]="FGREATERP";Z[Z.IGREATERP=241]="IGREATERP";Z[Z.GREATERP=243]="GREATERP";Z[Z.EQ=240]="EQ";Z[Z.EQUAL=244]="EQUAL";Z[Z.MAKENUMBER=245]="MAKENUMBER";Z[Z.BOXIPLUS=246]="BOXIPLUS";Z[Z.BOXIDIFFERENCE=247]="BOXIDIFFERENCE";Z[Z.FLOATBLT=248]="FLOATBLT";Z[Z.FFTSTEP=249]="FFTSTEP";Z[Z.MISC3=250]="MISC3";Z[Z.MISC4=251]="MISC4";Z[Z.UPCTRACE=252]="UPCTRACE";Z[Z.CL_EQUAL=255]="CL_EQUAL";Z[Z.SWAP=253]="SWAP";Z[Z.NOP=254]="NOP";Z[Z.JUMP0=128]="JUMP0";Z[Z.JUMP1=129]="JUMP1";Z[Z.JUMP2=130]="JUMP2";Z[Z.JUMP3=131]="JUMP3";Z[Z.JUMP4=132]="JUMP4";Z[Z.JUMP5=133]="JUMP5";Z[Z.JUMP6=134]="JUMP6";Z[Z.JUMP7=135]="JUMP7";Z[Z.JUMP8=136]="JUMP8";Z[Z.JUMP9=137]="JUMP9";Z[Z.JUMP10=138]="JUMP10";Z[Z.JUMP11=139]="JUMP11";Z[Z.JUMP12=140]="JUMP12";Z[Z.JUMP13=141]="JUMP13";Z[Z.JUMP14=142]="JUMP14";Z[Z.JUMP15=143]="JUMP15";Z[Z.FJUMP0=144]="FJUMP0";Z[Z.FJUMP1=145]="FJUMP1";Z[Z.FJUMP2=146]="FJUMP2";Z[Z.FJUMP3=147]="FJUMP3";Z[Z.FJUMP4=148]="FJUMP4";Z[Z.FJUMP5=149]="FJUMP5";Z[Z.FJUMP6=150]="FJUMP6";Z[Z.FJUMP7=151]="FJUMP7";Z[Z.FJUMP8=152]="FJUMP8";Z[Z.FJUMP9=153]="FJUMP9";Z[Z.FJUMP10=154]="FJUMP10";Z[Z.FJUMP11=155]="FJUMP11";Z[Z.FJUMP12=156]="FJUMP12";Z[Z.FJUMP13=157]="FJUMP13";Z[Z.FJUMP14=158]="FJUMP14";Z[Z.FJUMP15=159]="FJUMP15";Z[Z.TJUMP0=160]="TJUMP0";Z[Z.TJUMP1=161]="TJUMP1";Z[Z.TJUMP2=162]="TJUMP2";Z[Z.TJUMP3=163]="TJUMP3";Z[Z.TJUMP4=164]="TJUMP4";Z[Z.TJUMP5=165]="TJUMP5";Z[Z.TJUMP6=166]="TJUMP6";Z[Z.TJUMP7=167]="TJUMP7";Z[Z.TJUMP8=168]="TJUMP8";Z[Z.TJUMP9=169]="TJUMP9";Z[Z.TJUMP10=170]="TJUMP10";Z[Z.TJUMP11=171]="TJUMP11";Z[Z.TJUMP12=172]="TJUMP12";Z[Z.TJUMP13=173]="TJUMP13";Z[Z.TJUMP14=174]="TJUMP14";Z[Z.TJUMP15=175]="TJUMP15";Z[Z.JUMPX=176]="JUMPX";Z[Z.JUMPXX=177]="JUMPXX";Z[Z.FJUMPX=178]="FJUMPX";Z[Z.TJUMPX=179]="TJUMPX";Z[Z.NFJUMPX=180]="NFJUMPX";Z[Z.NTJUMPX=181]="NTJUMPX";Z[Z.AREF1=182]="AREF1";Z[Z.ASET1=183]="ASET1";Z[Z.PVARSETPOP0=184]="PVARSETPOP0";Z[Z.PVARSETPOP1=185]="PVARSETPOP1";Z[Z.PVARSETPOP2=186]="PVARSETPOP2";Z[Z.PVARSETPOP3=187]="PVARSETPOP3";Z[Z.PVARSETPOP4=188]="PVARSETPOP4";Z[Z.PVARSETPOP5=189]="PVARSETPOP5";Z[Z.PVARSETPOP6=190]="PVARSETPOP6";Z[Z.IVAR0=64]="IVAR0";Z[Z.IVAR1=65]="IVAR1";Z[Z.IVAR2=66]="IVAR2";Z[Z.IVAR3=67]="IVAR3";Z[Z.IVAR4=68]="IVAR4";Z[Z.IVAR5=69]="IVAR5";Z[Z.IVAR6=70]="IVAR6";Z[Z.IVARX=71]="IVARX";Z[Z.PVAR0=72]="PVAR0";Z[Z.PVAR1=73]="PVAR1";Z[Z.PVAR2=74]="PVAR2";Z[Z.PVAR3=75]="PVAR3";Z[Z.PVAR4=76]="PVAR4";Z[Z.PVAR5=77]="PVAR5";Z[Z.PVAR6=78]="PVAR6";Z[Z.PVARX=79]="PVARX";Z[Z.FVAR0=80]="FVAR0";Z[Z.FVAR1=81]="FVAR1";Z[Z.FVAR2=82]="FVAR2";Z[Z.FVAR3=83]="FVAR3";Z[Z.FVAR4=84]="FVAR4";Z[Z.FVAR5=85]="FVAR5";Z[Z.FVAR6=86]="FVAR6";Z[Z.FVARX=87]="FVARX";Z[Z.PVAR_0=88]="PVAR_0";Z[Z.PVAR_1=89]="PVAR_1";Z[Z.PVAR_2=90]="PVAR_2";Z[Z.PVAR_3=91]="PVAR_3";Z[Z.PVAR_4=92]="PVAR_4";Z[Z.PVAR_5=93]="PVAR_5";Z[Z.PVAR_6=94]="PVAR_6";Z[Z.COPY=100]="COPY";Z[Z.MYARGCOUNT=101]="MYARGCOUNT";Z[Z.MYALINK=102]="MYALINK";Z[Z.STKSCAN=47]="STKSCAN";Z[Z.SLRETURN=63]="SLRETURN"})(D||={});function Q$($){if($>=128&&$<=143)return 1;if($>=144&&$<=159)return 1;if($>=160&&$<=175)return 1;if($===176||$===178||$===179||$===180||$===181)return 3;if($===177)return 5;return 1}function J$($){if($ in D)return $;return null}function W$($,q){if($.virtualMemory===null)return null;let Q=$.virtualMemory,J=j.Access.readByteXor(Q,q);if(J===null)return null;let W=J$(J);if(W===null)return null;let L=Q$(W);if(q+L>Q.length)return null;let X=new Uint8Array(Math.max(0,L-1));for(let z=0;z<X.length;z++){let Y=q+z+1,E=j.Access.readByteXor(Q,Y);if(E===null)return null;X[z]=E}return{opcode:W,operands:X,length:L}}var j$=new Map;function K($,q){j$.set($,q)}function A$($){return j$.get($)??null}function K$($,q){let Q=A$(q.opcode);if(Q)return Q($,q);return null}function B($,q){if($.virtualMemory===null)return;if($.topOfStack=q,$.cstkptrl===null)$.cstkptrl=$.stackPtr;else $.cstkptrl+=4;if($.cstkptrl>=0&&$.cstkptrl+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,$.cstkptrl,q);$.stackPtr=$.cstkptrl}function C($){if($.virtualMemory===null)return 0;let q=$.topOfStack;if($.cstkptrl!==null&&$.cstkptrl>=4)if($.cstkptrl-=4,$.cstkptrl>=0&&$.cstkptrl+4<=$.virtualMemory.length)$.topOfStack=j.Access.readLispPTR($.virtualMemory,$.cstkptrl);else $.topOfStack=0;else $.topOfStack=0;return $.stackPtr=$.cstkptrl??$.stackBase,q}function F$($,q){return B($,0),null}function R$($,q){return B($,1),null}function _$($,q){return B($,0),null}function w$($,q){return B($,1),null}function b$($,q){if($.virtualMemory===null)return null;let Q=j.Access.readByteXor($.virtualMemory,$.pc+1);if(Q===null)return null;let W=14680064|Q;return B($,W),null}K(104,F$);K(105,R$);K(106,_$);K(107,w$);K(103,b$);function S$($,q){return C($),null}function P$($,q){if($.virtualMemory===null)return null;let Q=j.Access.readByteXor($.virtualMemory,$.pc+1);if(Q===null)return null;let J=Q;for(let W=0;W<J;W++)C($);return null}K(191,S$);K(192,P$);function N($){return($&14680064)===14680064}function I($){let q=$&1048575;if(q&524288)return q|4293918720;return q}function y($){return 14680064|$&1048575}function O($){let q=C($),Q=$.topOfStack;if(N(Q)&&N(q)){let J=I(Q),W=I(q),L=J+W;$.topOfStack=y(L)}else $.topOfStack=Q+q&16777215;return $.topOfStack}function v($){let q=C($),Q=$.topOfStack;if(N(Q)&&N(q)){let J=I(Q),W=I(q),L=J-W;$.topOfStack=y(L)}else $.topOfStack=Q-q&16777215;return $.topOfStack}function a($){let q=C($),Q=$.topOfStack;if(N(Q)&&N(q)){let J=I(Q),W=I(q),L=J*W;$.topOfStack=y(L)}else $.topOfStack=Q*q&16777215;return $.topOfStack}function L$($){let q=C($),Q=$.topOfStack;if(N(Q)&&N(q)){let J=I(Q),W=I(q);if(W===0)$.topOfStack=0;else{let L=Math.floor(J/W);$.topOfStack=y(L)}}else $.topOfStack=0;return $.topOfStack}function X$($){return O($)}function z$($){return v($)}function Y$($){return a($)}function M$($,q){return O($),null}function u$($,q){return v($),null}function h$($,q){return a($),null}function g$($,q){return L$($),null}function y$($,q){return X$($),null}function l$($,q){return z$($),null}function f$($,q){return Y$($),null}K(212,M$);K(213,u$);K(214,h$);K(215,g$);K(216,y$);K(217,l$);K(201,f$);class A{static getDefCell($,q,Q){let J=q+Q*4;if(J+4<=$.length){let W=j.Access.readLispPTR($,J),L=W&2147483648?1:0,X=W>>24&127;return{defpointer:W&2147483647,ccodep:L,argtype:X}}return null}static isCCode($){return $.ccodep!==0}static getFunctionHeaderPtr($){return $.defpointer&2147483647}static readFunctionHeader($,q){let Q=j.Address.lispPtrToByte(q);if(Q+16>$.length)return null;let J=j.Access.readDLword($,Q),W=j.Access.readDLword($,Q+2),L=j.Access.readDLword($,Q+4),X=j.Access.readDLword($,Q+6),z=$[Q+8],Y=z>>7&1,E=z>>6&1,k=z>>4&3,U=z&15,H=$[Q+9]<<16|$[Q+10]<<8|$[Q+11],S=U<<24|H,F=j.Access.readDLword($,Q+12),u=$[Q+14],x=$[Q+15],h=new Int16Array([W])[0],I$=new Int16Array([L])[0];return{stkmin:J,na:h,pv:I$,startpc:X,nil4:Y,byteswapped:E,argtype:k,framename:S,ntsize:F,nlocals:u,fvaroffset:x}}}var n$=1073741824,i$=2147483648,G$=4294967295;function w($,q,Q){if($.virtualMemory===null)return null;let J;if(q.opcode===13){if(q.operands.length<2)return null;Q=q.operands[0],J=q.operands[1]}else{if(q.operands.length<1)return null;J=q.operands[0]}let W=A.getDefCell($.virtualMemory,$.atomSpaceOffset,J);if(!W)return console.warn(`FN: Definition cell not found for atom index ${J}`),null;if(A.isCCode(W))return console.warn(`FN: C code functions not yet supported for atom index ${J}`),null;let L=A.getFunctionHeaderPtr(W);if(L===0)return console.warn(`FN: Function header pointer is 0 for atom index ${J}`),null;let X=A.readFunctionHeader($.virtualMemory,L);if(!X)return console.warn(`FN: Failed to read function header at 0x${L.toString(16)}`),null;let z=q.length,Y=$.pc-($.funcObj||0)+z,k=($.stackPtr-Q*4+4-$.stackBase)/2;if(B($,$.topOfStack),X.na>=0){let x=Q-X.na;if(x<0)for(let h=0;h<-x;h++)B($,M);else if(x>0){if($.stackPtr-=x*4,$.cstkptrl!==null)$.cstkptrl-=x}}let U=i$|k&65535;B($,U);let H=($.stackPtr-$.stackBase)/2,S=n$<<16|H&65535;B($,S);let F=$.stackPtr;if(j.Access.writeLispPTR($.virtualMemory,F,L),$.stackPtr+=g*2,$.cstkptrl=$.stackPtr,$.pvar=$.stackPtr,X.pv>=0)for(let x=X.pv;x>=0;x--)B($,G$),B($,G$);B($,M);let u=j.Address.lispPtrToByte(L);return $.pc=u+X.startpc+1,$.funcObj=u,$.syncTopOfStack(),null}function s$($,q){return w($,q,0)}function t$($,q){return w($,q,1)}function O$($,q){return w($,q,2)}function v$($,q){return w($,q,3)}function a$($,q){return w($,q,4)}function c$($,q){return w($,q,-1)}function r$($,q){if($.virtualMemory===null||$.cstkptrl===null)return null;let Q=$.topOfStack,J=!1,W=$.cstkptrl;for(let k=0;k<1000;k++){if(W-=4,W<$.stackEnd||W>=$.stackBase)break;if((j.Access.readLispPTR($.virtualMemory,W)&1073741824)!==0){J=!0;break}}if(!J)return console.warn("RETURN: FX marker not found"),null;let L=j.Access.readLispPTR($.virtualMemory,W);if(!A.readFunctionHeader($.virtualMemory,L&2147483647))return console.warn("RETURN: Failed to read function header"),null;let z=W+10,Y=j.Access.readDLword($.virtualMemory,z),E=j.Address.lispPtrToByte(L&2147483647);return $.pc=E+Y,$.funcObj=E,$.stackPtr=W,$.cstkptrl=W,$.topOfStack=Q,$.syncTopOfStack(),null}K(8,s$);K(9,t$);K(10,O$);K(11,v$);K(12,a$);K(13,c$);K(16,r$);function p$($,q){if($.virtualMemory===null)return null;if(q.operands.length<2)return null;return j.Access.readJumpOffset($.virtualMemory,$.pc)}function m$($,q){if($.topOfStack===0)return j.Access.readJumpOffset($.virtualMemory,$.pc);return null}function d$($,q){if($.topOfStack!==0)return j.Access.readJumpOffset($.virtualMemory,$.pc);return null}K(176,p$);K(178,m$);K(179,d$);function o$($,q){return null}function e$($,q){return null}function $0($,q){return null}function Z0($,q){return null}K(200,o$);K(205,e$);K(236,$0);K(206,Z0);function q0($,q){return null}function Q0($,q){return null}function J0($,q){return null}function W0($,q){return null}K(232,q0);K(233,Q0);K(234,J0);K(235,W0);function j0($,q){return null}function K0($,q){return null}function L0($,q){return null}K(196,j0);K(48,K0);K(59,L0);class V{static readPVAR($,q){if($.virtualMemory===null||$.currentFrame===null)return 0;let Q=$.getFramePtrOffset(),J=j.Address.lispPtrToByte(Q)+g*2+q*4;if(J+4<=$.virtualMemory.length)return j.Access.readLispPTR($.virtualMemory,J);return 0}static readIVAR($,q){return 0}static readFVAR($,q){return 0}static readARG0($){return 0}static parseFrame($,q){if($.virtualMemory===null)return null;let Q=j.Address.lispPtrToByte(q);if(Q+20>$.virtualMemory.length)return null;return{flags_usecount:j.Access.readDLword($.virtualMemory,Q),alink:j.Access.readDLword($.virtualMemory,Q+2),lofnheader:j.Access.readDLword($.virtualMemory,Q+4),hi1fnheader_hi2fnheader:j.Access.readDLword($.virtualMemory,Q+6),nextblock:j.Access.readDLword($.virtualMemory,Q+8),pc:j.Access.readDLword($.virtualMemory,Q+10),lonametable:j.Access.readDLword($.virtualMemory,Q+12),hi1nametable_hi2nametable:j.Access.readDLword($.virtualMemory,Q+14),blink:j.Access.readDLword($.virtualMemory,Q+16),clink:j.Access.readDLword($.virtualMemory,Q+18)}}}function X0($,q){if($.virtualMemory===null)return null;let Q=j.Access.readByteXor($.virtualMemory,$.pc+1);if(Q===null)return null;let J=Q,W=AtomSpaceManager.getValueCell($.virtualMemory,$.valSpaceOffset,J);return pushStack($,W),null}function z0($,q){let Q=V.readARG0($);return $.topOfStack=Q,null}function Y0($,q){return $.topOfStack=V.readIVAR($,0),null}function G0($,q){return $.topOfStack=V.readIVAR($,1),null}function U0($,q){return $.topOfStack=V.readIVAR($,2),null}function B0($,q){return $.topOfStack=V.readIVAR($,3),null}function V0($,q){return $.topOfStack=V.readIVAR($,4),null}function D0($,q){return $.topOfStack=V.readIVAR($,5),null}function E0($,q){return $.topOfStack=V.readIVAR($,6),null}function k0($,q){if($.virtualMemory===null)return null;let Q=j.Access.readByteXor($.virtualMemory,$.pc+1);if(Q===null)return null;return $.topOfStack=V.readIVAR($,Q),null}function H0($,q){return $.topOfStack=V.readPVAR($,0),null}function x0($,q){return $.topOfStack=V.readPVAR($,1),null}function C0($,q){return $.topOfStack=V.readPVAR($,2),null}function T0($,q){return $.topOfStack=V.readPVAR($,3),null}function N0($,q){return $.topOfStack=V.readPVAR($,4),null}function I0($,q){return $.topOfStack=V.readPVAR($,5),null}function A0($,q){return $.topOfStack=V.readPVAR($,6),null}function F0($,q){if($.virtualMemory===null)return null;let Q=j.Access.readByteXor($.virtualMemory,$.pc+1);if(Q===null)return null;return $.topOfStack=V.readPVAR($,Q),null}K(96,X0);K(97,z0);K(64,Y0);K(65,G0);K(66,U0);K(67,B0);K(68,V0);K(69,D0);K(70,E0);K(71,k0);K(72,H0);K(73,x0);K(74,C0);K(75,T0);K(76,N0);K(77,I0);K(78,A0);K(79,F0);var R0=0,_0=128,w0=254;function b0($,q){if(q===0)return!1;if($.virtualMemory===null)return!1;return j.Address.lispPtrToByte(q)<$.virtualMemory.length}function S0($,q){if($.virtualMemory===null)return 0;if(q===0)return 0;let Q=j.Address.lispPtrToByte(q);if(Q+4>$.virtualMemory.length)return 0;return j.Access.readLispPTR($.virtualMemory,Q)}function P0($,q){if($.virtualMemory===null)return 0;if(q===0)return 0;let Q=j.Address.lispPtrToByte(q);if(Q+5>$.virtualMemory.length)return 0;let J=$.virtualMemory[Q+4];if(J===R0)return 0;else if((J&_0)!==0){let W=j.Address.getVirtualAddressBase(j.Address.getVirtualPage(Q)),L=(J&127)<<1;return j.Address.byteToLispPtr(W+L)}else if(J===w0){let W=Q+8;if(W+4>$.virtualMemory.length)return 0;return j.Access.readLispPTR($.virtualMemory,W)}else{let W=j.Address.getVirtualAddressBase(j.Address.getVirtualPage(Q)),L=J<<1;return j.Address.byteToLispPtr(W+L)}}function M0($,q){let Q=$.topOfStack,J=S0($,Q);return $.topOfStack=J,null}function u0($,q){let Q=$.topOfStack,J=P0($,Q);return $.topOfStack=J,null}function h0($,q){if($.virtualMemory===null)return null;let Q=$.topOfStack,J=0,W=0;return $.topOfStack=W,null}function g0($,q){if($.virtualMemory===null)return null;let Q=$.topOfStack,J=0,W=j.Address.lispPtrToByte(J);if(W+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,W,Q);return $.topOfStack=J,null}function y0($,q){if($.virtualMemory===null)return null;let Q=$.topOfStack,J=0;return $.topOfStack=J,null}function l0($,q){let Q=$.topOfStack,J=b0($,Q);return $.topOfStack=J?1:0,null}K(1,M0);K(2,u0);K(26,h0);K(24,g0);K(25,y0);K(5,l0);function f0($,q){let Q=$.topOfStack;return B($,Q),null}K(100,f0);function n0($,q){if($.virtualMemory===null)return null;if(q.operands.length<2)return null;let Q=q.operands[0],J=q.operands[1],W=Q>>4&15,L=Q&15,Y=$.stackPtr+20+(1+J)*4;for(let U=0;U<W;U++){let H=Y-(U+1)*4;if(H>=0&&H+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,H,M)}if(L===0)B($,$.topOfStack);else{let U=Y-(W+1)*4;if(U>=0&&U+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,U,$.topOfStack);for(let H=1;H<L;H++){let S=C($),F=Y-(W+H+1)*4;if(F>=0&&F+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,F,S)}}let k=(~(W+L)&65535)<<16|J<<1&65535;return B($,k),null}function i0($,q){if($.virtualMemory===null||$.cstkptrl===null)return null;let Q=!1,J=0,W=$.cstkptrl;for(let k=0;k<1000;k++){if(W-=4,W<$.stackEnd||W>=$.stackBase)break;let U=j.Access.readLispPTR($.virtualMemory,W);if((U&2147483648)!==0){Q=!0,J=U,$.cstkptrl=W;break}}if(!Q)return console.warn("UNBIND: Marker not found"),null;let L=~(J>>16)&65535,X=(J&65535)>>1,Y=$.stackPtr+20+(2+X)*4,E=4294967295;for(let k=0;k<L;k++){let U=Y-(k+1)*4;if(U>=0&&U+4<=$.virtualMemory.length)j.Access.writeLispPTR($.virtualMemory,U,E)}return $.syncTopOfStack(),null}function s0($,q){return console.warn(`DUNBIND (0x${19 .toString(16)}) not implemented.`),null}K(17,n0);K(18,i0);K(19,s0);function t0($,q){return $.initCSTKPTRLFromCurrentStackPTR(),$.syncTopOfStack(),O0($,q)}function O0($,q){let Q=K$($,q);if(Q===null){let J=q.opcode;if(J>=128&&J<=143)return J-128+1;if(J>=144&&J<=159){if($.topOfStack===0)return J-144+1;return null}if(J>=160&&J<=175){if($.topOfStack!==0)return J-160+1;return null}}return Q}function c($){if($.virtualMemory===null)return!1;if($.maxSteps!==null&&$.totalInstructionCount>=$.maxSteps)return $.stopRequested=!0,!1;if($.stopRequested)return!1;let q=W$($,$.pc);if(q===null)return $.stopRequested=!0,!1;let Q=t0($,q);if(Q!==null){let J=$.pc+Q;if(J<0||J>=$.virtualMemory.length)return $.stopRequested=!0,!1;if($.pc=J,Q===0)$.pc+=q.length}else $.pc+=q.length;return $.totalInstructionCount++,!0}function v0($,q){let Q=new DataView($,q),J={resetfxp:Q.getUint16(0,!0),currentfxp:Q.getUint16(2,!0),kbdfxp:Q.getUint16(4,!0),subovfxp:Q.getUint16(6,!0),gcfxp:Q.getUint16(8,!0),hardreturnfxp:Q.getUint16(10,!0),endofstack:Q.getUint16(12,!0),faultfxp:Q.getUint16(14,!0),minrversion:Q.getUint16(16,!0),lversion:Q.getUint16(18,!0),rversion:Q.getUint16(20,!0),minbversion:Q.getUint16(22,!0),machinetype:Q.getUint16(24,!0),bversion:Q.getUint16(26,!0),key:Q.getUint16(28,!0),miscfxp:Q.getUint16(30,!0),emulatorspace:Q.getUint16(32,!0),serialnumber:Q.getUint16(34,!0),nxtpmaddr:Q.getUint16(36,!0),screenwidth:Q.getUint16(38,!0),ndirtypages:Q.getUint16(40,!0),nactivepages:Q.getUint16(42,!0),filepnpmt0:Q.getUint16(44,!0),filepnpmp0:Q.getUint16(46,!0),filler1:Q.getUint16(48,!0),teleraidfxp:Q.getUint16(50,!0),filler3:Q.getUint16(52,!0),filler2:Q.getUint16(54,!0),userpswdaddr:Q.getUint16(56,!0),usernameaddr:Q.getUint16(58,!0),faulthi:Q.getUint16(60,!0),stackbase:Q.getUint16(62,!0),devconfig:Q.getUint16(64,!0),faultlo:Q.getUint16(66,!0),rpoffset:Q.getUint16(68,!0),rptsize:Q.getUint16(70,!0),embufvp:Q.getUint16(72,!0),wasrptlast:Q.getUint16(74,!0),nshost1:Q.getUint16(76,!0),nshost0:Q.getUint16(78,!0),mdszone:Q.getUint16(80,!0),nshost2:Q.getUint16(82,!0),emubuffers:Q.getUint16(84,!0),mdszonelength:Q.getUint16(86,!0),process_size:Q.getUint16(88,!0),emubuflength:Q.getUint16(90,!0),isfmap:Q.getUint16(92,!0),storagefullstate:Q.getUint16(94,!0),miscstackfn:Q.getUint32(96,!0),miscstackarg1:Q.getUint32(100,!0),miscstackarg2:Q.getUint32(104,!0),miscstackresult:Q.getUint32(108,!0),lastlockedfilepage:Q.getUint16(112,!0),nrealpages:Q.getUint16(114,!0),fptovpstart:Q.getUint16(116,!0),lastdominofilepage:Q.getUint16(118,!0),dl24bitaddressable:Q.getUint16(120,!0),fakemousebits:Q.getUint16(122,!0),realpagetableptr:Q.getUint32(124,!0),fullspaceused:Q.getUint16(128,!0),dllastvmempage:Q.getUint16(130,!0),fakekbdad5:Q.getUint16(132,!0),fakekbdad4:Q.getUint16(134,!0)};if(J.key!==f)throw Error(`Invalid IFPAGE key: expected 0x${f.toString(16)}, got 0x${J.key.toString(16)}`);return J}function a0($,q,Q){let W=Math.floor(Q/_)*4,L=n+144,X=$.slice(L,L+W),z=new Uint32Array(X);for(let Y=0;Y<z.length;Y++)z[Y]=j.Endianness.swapU32(z[Y]);return z}function c0($,q){let J=new Uint8Array(1048576),W=new Uint8Array($),L=Math.min(W.length,J.length);return J.set(W.slice(0,L),0),J}function r0($,q){let Q=P*2,J=q.currentfxp,W=Q+J*2;if(W+14>$.length)return 0;let L=$[W+4]|$[W+5]<<8;return($[W+7]<<16|L)*2}async function U$($){let q=v0($,n);if(q===null)throw Error("Failed to parse IFPAGE");let Q=a0($,q,$.byteLength),J=c0($,Q),W=r0(J,q),L=P*2,X=j.Address.lispPtrToByte(e),z=j.Address.lispPtrToByte($$),Y=j.Address.lispPtrToByte(Z$);return{virtualMemory:J,fptovpTable:Q,ifpage:q,initialPC:W,initialSP:L,atomSpaceOffset:X,defSpaceOffset:z,valSpaceOffset:Y}}class r{gl=null;canvas;program=null;texture=null;displayWidth=0;displayHeight=0;constructor($){this.canvas=$,this.initWebGL()}initWebGL(){let $=this.canvas.getContext("webgl2");if(!$)throw Error("WebGL 2.0 not supported");this.gl=$,this.program=this.createShaderProgram(),this.texture=$.createTexture(),$.bindTexture($.TEXTURE_2D,this.texture),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.NEAREST),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE)}createShaderProgram(){if(!this.gl)throw Error("WebGL not initialized");let $=`#version 300 es
            in vec2 a_position;
            in vec2 a_texCoord;
            out vec2 v_texCoord;
            void main() {
                gl_Position = vec4(a_position, 0.0, 1.0);
                v_texCoord = a_texCoord;
            }
        `,q=`#version 300 es
            precision highp float;
            uniform sampler2D u_texture;
            uniform vec2 u_resolution;
            in vec2 v_texCoord;
            out vec4 fragColor;
            void main() {
                vec2 coord = v_texCoord;
                vec4 color = texture(u_texture, coord);
                fragColor = color;
            }
        `,Q=this.compileShader(this.gl.VERTEX_SHADER,$),J=this.compileShader(this.gl.FRAGMENT_SHADER,q),W=this.gl.createProgram();if(!W)throw Error("Failed to create program");if(this.gl.attachShader(W,Q),this.gl.attachShader(W,J),this.gl.linkProgram(W),!this.gl.getProgramParameter(W,this.gl.LINK_STATUS)){let L=this.gl.getProgramInfoLog(W);throw Error(`Program link failed: ${L}`)}return W}compileShader($,q){if(!this.gl)throw Error("WebGL not initialized");let Q=this.gl.createShader($);if(!Q)throw Error("Failed to create shader");if(this.gl.shaderSource(Q,q),this.gl.compileShader(Q),!this.gl.getShaderParameter(Q,this.gl.COMPILE_STATUS)){let J=this.gl.getShaderInfoLog(Q);throw this.gl.deleteShader(Q),Error(`Shader compilation failed: ${J}`)}return Q}updateDisplay($,q,Q){if(!this.gl||!this.texture||!this.program)return;this.displayWidth=q,this.displayHeight=Q;let J=new Uint8Array(q*Q*4);for(let W=0;W<$.length;W++){let L=$[W],X=Math.floor(W/q),z=W%q,Y=(X*q+z)*4,E=L&1;J[Y]=E?255:0,J[Y+1]=E?255:0,J[Y+2]=E?255:0,J[Y+3]=255}this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,q,Q,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,J)}render(){if(!this.gl||!this.program||!this.texture)return;this.gl.useProgram(this.program),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let $=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),q=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,q),this.gl.bufferData(this.gl.ARRAY_BUFFER,$,this.gl.STATIC_DRAW);let Q=this.gl.getAttribLocation(this.program,"a_position"),J=this.gl.getAttribLocation(this.program,"a_texCoord");if(Q>=0)this.gl.enableVertexAttribArray(Q),this.gl.vertexAttribPointer(Q,2,this.gl.FLOAT,!1,16,0);if(J>=0)this.gl.enableVertexAttribArray(J),this.gl.vertexAttribPointer(J,2,this.gl.FLOAT,!1,16,8);let W=this.gl.getUniformLocation(this.program,"u_resolution");if(W)this.gl.uniform2f(W,this.canvas.width,this.canvas.height);this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}class p{lines=[];lineNumber=0;logInstruction($,q,Q=!1){let J=this.formatTraceLine($,q,Q);this.lines.push(J),this.lineNumber++}formatTraceLine($,q,Q){let J=[];J.push(this.lineNumber.toString()),J.push(`0x${$.pc.toString(16)}`),J.push(D[q.opcode]||`0x${q.opcode.toString(16)}`),J.push(`0x${q.opcode.toString(16)}`);let W=Array.from(q.operands).map((X)=>`0x${X.toString(16).padStart(2,"0")}`).join(",");J.push(W||"-");let L=`PC=0x${$.pc.toString(16)} SP=0x${$.getStackPtrOffset().toString(16)} FP=0x${$.getFramePtrOffset().toString(16)} TOS=0x${$.topOfStack.toString(16)}`;return J.push(L),J.push("-"),J.push(`SP=0x${$.getStackPtrOffset().toString(16)} FP=0x${$.getFramePtrOffset().toString(16)}`),J.push(`TOS=0x${$.topOfStack.toString(16)}`),J.push("-"),J.push("-"),J.push("-"),J.push("-"),J.join("|")}export(){return this.lines.join(`
`)}clear(){this.lines=[],this.lineNumber=0}}class m{vm;canvas;options;traceEnabled=!1;traceBuffer=[];renderer=null;tracer=null;animationFrameId=null;constructor($,q={}){this.canvas=$,this.options=q,this.vm=new t,this.traceEnabled=q.enableTracing??!1;try{this.renderer=new r($)}catch(Q){console.error("Failed to initialize WebGL:",Q)}if(this.traceEnabled)this.tracer=new p;if(q.maxSteps!==void 0)this.vm.maxSteps=q.maxSteps,this.vm.stepCapActive=!0}async loadSysout($){let q=await U$($);this.vm.initializeMemory(q.virtualMemory,q.fptovpTable,q.atomSpaceOffset,q.defSpaceOffset,q.valSpaceOffset),this.vm.pc=q.initialPC,this.vm.stackPtr=q.initialSP,this.vm.cstkptrl=q.initialSP;let Q=q.ifpage.screenwidth||1024,J=768,W=2097152;this.vm.initializeDisplay(W,Q,J)}start(){if(this.vm.virtualMemory===null)throw Error("Sysout not loaded");this.runExecutionLoop()}runExecutionLoop(){let $=()=>{if(this.vm.stopRequested||!this.vm.running){this.animationFrameId=null;return}let q=1000;for(let Q=0;Q<q&&!this.vm.stopRequested;Q++)if(!c(this.vm))break;this.updateDisplay(),this.animationFrameId=requestAnimationFrame($)};this.vm.running=!0,this.vm.stopRequested=!1,this.animationFrameId=requestAnimationFrame($)}updateDisplay(){if(!this.renderer||!this.vm.displayRegion)return;let $=this.vm.displayRegion,q=this.vm.displayWidth,Q=this.vm.displayHeight;if(q>0&&Q>0)this.renderer.updateDisplay($,q,Q),this.renderer.render()}stop(){if(this.vm.stopRequested=!0,this.vm.running=!1,this.animationFrameId!==null)cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null}reset(){this.vm.reset()}step(){if(this.vm.virtualMemory===null)throw Error("Sysout not loaded");c(this.vm)}getState(){return{pc:this.vm.pc,sp:this.vm.getStackPtrOffset(),fp:this.vm.getFramePtrOffset(),running:this.vm.running}}hasTrace(){return this.tracer!==null&&this.tracer.export().length>0}exportTrace(){if(this.tracer)return this.tracer.export();return""}}var G=null,R=document.getElementById("fileDropZone"),E$=document.getElementById("fileInput"),p0=document.getElementById("fileInfo"),m0=document.getElementById("displayCanvas"),k$=document.getElementById("startBtn"),H$=document.getElementById("stopBtn"),x$=document.getElementById("resetBtn"),C$=document.getElementById("stepBtn"),l=document.getElementById("statusDisplay"),d0=document.getElementById("pcValue"),o0=document.getElementById("spValue"),e0=document.getElementById("fpValue"),$Z=document.getElementById("fpsValue"),ZZ=document.getElementById("traceEnabled"),T$=document.getElementById("exportTraceBtn"),d=document.getElementById("errorDisplay");R.addEventListener("dragover",($)=>{$.preventDefault(),R.classList.add("dragover")});R.addEventListener("dragleave",()=>{R.classList.remove("dragover")});R.addEventListener("drop",async($)=>{$.preventDefault(),R.classList.remove("dragover");let q=$.dataTransfer?.files;if(q&&q.length>0)await N$(q[0])});E$.addEventListener("change",async($)=>{let q=$.target.files;if(q&&q.length>0)await N$(q[0])});R.addEventListener("click",()=>{E$.click()});k$.addEventListener("click",()=>{if(G)G.start(),b(!0)});H$.addEventListener("click",()=>{if(G)G.stop(),b(!1)});x$.addEventListener("click",()=>{if(G)G.reset(),b(!1)});C$.addEventListener("click",()=>{if(G)G.step()});T$.addEventListener("click",()=>{if(G){let $=G.exportTrace();if($){let q=new Blob([$],{type:"text/plain"}),Q=URL.createObjectURL(q),J=document.createElement("a");J.href=Q,J.download="taiko_trace.txt",J.click(),URL.revokeObjectURL(Q)}}});async function N$($){try{D$(null),l.innerHTML="<p>Loading file...</p>";let q=await $.arrayBuffer();p0.textContent=`File: ${$.name} (${($.size/1024).toFixed(2)} KB)`,l.innerHTML="<p>Initializing emulator...</p>",G=new m(m0,{enableTracing:ZZ.checked}),await G.loadSysout(q),l.innerHTML="<p>Emulator ready</p>",b(!1),qZ()}catch(q){D$(q),l.innerHTML="<p>Error loading file</p>"}}function b($){k$.disabled=!G||$,H$.disabled=!G||!$,x$.disabled=!G,C$.disabled=!G||$,T$.disabled=!G||!G.hasTrace()}var B$=performance.now(),o=0,V$=0;function qZ(){function $(){if(G){let q=G.getState();d0.textContent=`0x${q.pc.toString(16)}`,o0.textContent=`0x${q.sp.toString(16)}`,e0.textContent=`0x${q.fp.toString(16)}`,o++;let Q=performance.now();if(Q-B$>=1000)V$=o,o=0,B$=Q;$Z.textContent=V$.toString(),b(q.running)}requestAnimationFrame($)}requestAnimationFrame($)}function D$($){if($)d.style.display="block",d.innerHTML=`
            <h3>Error</h3>
            <pre>${$.message}
${$.stack}</pre>
        `;else d.style.display="none"}b(!1);
